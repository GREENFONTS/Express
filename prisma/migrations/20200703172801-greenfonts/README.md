# Migration `20200703172801-greenfonts`

This migration has been generated by GREENFONTS at 7/3/2020, 5:28:01 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."users" DROP COLUMN "Avatar",
DROP COLUMN "Email",
DROP COLUMN "Name",
DROP COLUMN "Password",
DROP COLUMN "Password2",
ADD COLUMN "avatar" text   ,
ADD COLUMN "email" text  NOT NULL ,
ADD COLUMN "name" text   ,
ADD COLUMN "password" text   ,
ADD COLUMN "password2" text   ;

CREATE UNIQUE INDEX "_UserFollows_AB_unique" ON "public"."_UserFollows"("A","B")

CREATE  INDEX "_UserFollows_B_index" ON "public"."_UserFollows"("B")

CREATE  INDEX "email" ON "public"."posts"("email")

CREATE  INDEX "email" ON "public"."todo"("email")

ALTER TABLE "public"."_UserFollows" ADD FOREIGN KEY ("A")REFERENCES "public"."users"("email") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_UserFollows" ADD FOREIGN KEY ("B")REFERENCES "public"."users"("email") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."comment" ADD FOREIGN KEY ("email")REFERENCES "public"."users"("email") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."likes" ADD FOREIGN KEY ("postid")REFERENCES "public"."posts"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."likes" ADD FOREIGN KEY ("email")REFERENCES "public"."users"("email") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."posts" ADD FOREIGN KEY ("email")REFERENCES "public"."users"("email") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."todo" ADD FOREIGN KEY ("email")REFERENCES "public"."users"("email") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER INDEX "public"."email" RENAME TO "Email"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200702212721-greenfonts..20200703172801-greenfonts
--- datamodel.dml
+++ datamodel.dml
@@ -4,9 +4,9 @@
 }
 datasource postgresql {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 model comment {
   comment String?
@@ -18,9 +18,9 @@
 }
 model likes {
   email  String?
-  id     String  @id
+  id     String  @id @default(cuid())
   postid String
   post   posts     @relation(fields:[postid], references:[id])
   users  users?    @relation(fields: [email], references: [email])
 }
```


